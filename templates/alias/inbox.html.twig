{% extends 'base.html.twig' %}

{% block title %}Inbox — {{ alias.localPart }}@{{ alias_domain }}{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{{ asset('styles/email-inbox.css') }}">
{% endblock %}

{% block body %}
<div class="inbox-list">
    {% include 'components/heading.html.twig' with { level: 1, content: 'Inbox' } %}

    {% include 'components/flash_messages.html.twig' %}

    <p class="inbox-list__intro">Messages for <strong>{{ alias.localPart }}@{{ alias_domain }}</strong></p>

    <p class="inbox-list__back">
        <a href="{{ path('app_home') }}">← Dashboard</a>
    </p>

    {% if messages is empty %}
        <p class="text-neutral-600">No messages yet.</p>
    {% else %}
        {% embed 'components/table.html.twig' %}
            {% block thead %}
                <th scope="col" class="px-4 py-3 text-left text-sm font-medium text-neutral-700">From</th>
                <th scope="col" class="px-4 py-3 text-left text-sm font-medium text-neutral-700">Subject</th>
                <th scope="col" class="px-4 py-3 text-left text-sm font-medium text-neutral-700">Preview</th>
                <th scope="col" class="px-4 py-3 text-left text-sm font-medium text-neutral-700">Received</th>
                <th scope="col" class="px-4 py-3 text-left text-sm font-medium text-neutral-700">Type</th>
                <th scope="col" class="px-4 py-3 text-left text-sm font-medium text-neutral-700">Actions</th>
            {% endblock %}
            {% block tbody %}
                {% for msg in messages %}
                    <tr>
                        <td class="px-4 py-3 text-left text-sm text-neutral-900">{{ msg.fromAddress }}</td>
                        <td class="px-4 py-3 text-left text-sm inbox-list__subject">{{ msg.subject }}</td>
                        <td class="px-4 py-3 text-left text-sm inbox-list__preview" title="{{ msg.previewSnippet ?? '' }}">{{ msg.previewSnippet ?? '—' }}</td>
                        <td class="px-4 py-3 text-left text-sm inbox-list__date">{{ msg.receivedAt|date('M j, Y g:i A') }}</td>
                        <td class="px-4 py-3 text-left text-sm">
                            {% if msg.hasHtmlBody %}<span class="inbox-list__badge">HTML</span>{% else %}—{% endif %}
                        </td>
                        <td class="px-4 py-3 text-left text-sm">
                            {% include 'components/button.html.twig' with { variant: 'secondary', label: 'View', url: path('app_message_show', { id: msg.id }) } %}
                        </td>
                    </tr>
                {% endfor %}
            {% endblock %}
        {% endembed %}
    {% endif %}
</div>
{% endblock %}
