{% extends 'base.html.twig' %}

{% block title %}{{ parsed ? parsed.subject : message.subject }}{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{{ asset('styles/email-inbox.css') }}">
{% endblock %}

{% block body %}
<div class="email-view">
    <p class="email-view__back">
        <a href="{{ path('app_alias_inbox', { id: message.alias.id }) }}">‚Üê Inbox ({{ message.alias.localPart }}@{{ alias_domain }})</a>
    </p>

    <header class="email-view__header">
        <h1 class="email-view__subject">{{ parsed ? parsed.subject : message.subject }}</h1>
        <dl class="email-view__meta">
            <div class="email-view__meta-row">
                <dt>From</dt>
                <dd>
                    {% if parsed %}
                        {% if parsed.fromName %}{{ parsed.fromName }} <span class="email-view__email">&lt;{{ parsed.fromEmail }}&gt;</span>{% else %}<span class="email-view__email">{{ parsed.fromEmail }}</span>{% endif %}
                    {% else %}
                        <span class="email-view__email">{{ message.fromAddress }}</span>
                    {% endif %}
                </dd>
            </div>
            {% if parsed and parsed.to %}
            <div class="email-view__meta-row">
                <dt>To</dt>
                <dd><span class="email-view__email">{{ parsed.to }}</span></dd>
            </div>
            {% endif %}
            <div class="email-view__meta-row">
                <dt>Date</dt>
                <dd>{{ parsed and parsed.date ? parsed.date|date('D, M j, Y \a\t g:i A') : message.receivedAt|date('D, M j, Y \a\t g:i A') }}</dd>
            </div>
        </dl>
    </header>

    <details class="email-view__raw">
        <summary>Raw source</summary>
        <pre class="email-view__raw-pre">{{ raw_mime }}</pre>
    </details>

    <div class="email-view__body">
        {% if body_safe_html is not null %}
            <div class="email-view__body-content">{{ body_safe_html|raw }}</div>
        {% else %}
            <div class="email-view__body-plain">{{ message.body }}</div>
        {% endif %}
    </div>

    <form method="post" action="{{ path('app_message_delete', { id: message.id }) }}" class="email-view__actions" data-turbo="false">
        <input type="hidden" name="_token" value="{{ csrf_token('delete_message') }}">
        {% include 'components/button.html.twig' with { variant: 'secondary', type: 'submit', label: 'Delete message' } %}
    </form>
</div>
{% endblock %}
